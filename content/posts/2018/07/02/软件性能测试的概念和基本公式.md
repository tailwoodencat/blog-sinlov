---
title: "软件性能测试的概念和基本公式"
date: 2018-07-02T10:00:00+00:00
description: "desc 软件性能测试的概念和基本公式"
draft: false
categories: ['basics']
tags: ['basics']
toc:
  enable: true
  auto: false
math:
  enable: true
mapbox:
  accessToken: ""
share:
  enable: true
comment:
  enable: true
---

# 谈到性能之前必须说的

- 软件性能是一个相对比较的概念，那么`没有比较别提性能！`
- 软件性能是在某个场景下的统计结果，`脱离场景别提性能！`
- 如果一个软件连基本的功能都无法满足，性能是啥？所以，`脱离功能下的性能测试毫无价值!`
- 谈到性能，就必须谈到性能基线，性能提高的本质是达到下一个基线，那么`定制性能基线是测试性能的目的!`

# 软件性能的关注点

软件性能在不同角色使用时，关注的点是不一样的，所以`必须分开看不同角色关注的性能点`

## 用户关注性能点

用户关注的是用户操作的相应时间

对于用户来说，当点击一个按钮、链接或发出一条指令开始，到系统把结果已用户感知的形式展现出来为止
这个过程所消耗的时间是`用户对这个软件性能的直观印象`

也就是我们所说的响应时间，当相应时间较小时，用户体验是很好的
当然`用户体验的响应时间包括个人主观因素和客观响应时间`
在设计软件时，我们就需要考虑到如何更好地结合这两部分达到用户最佳的体验

> 大数据量查询时，我们可以将先提取出来的数据展示给用户，在用户看的过程中继续进行数据检索，这样做虽然不会改变处理速度，但是用户的感知响应速度就是很快的

## 管理员关注性能点

1. 响应时间
1. 服务器资源使用情况是否合理
1. 应用服务器和数据库资源使用是否合理
1. 系统能否实现扩展
1. 系统最多支持多少用户访问、系统最大业务处理量是多少
1. 系统性能可能存在的瓶颈在哪里
1. 更换那些设备可以提高性能
1. 系统能否支持7×24小时的业务访问

## 开发人员关注性能点

1. 架构设计是否合理
1. 数据库设计是否合理
1. 代码是否存在性能方面的问题
1. 系统中是否存在不合理的线程同步方式
1. 系统中是否存在不合理的资源竞争
1. 系统中是否有不合理的内存使用方式

## 测试人员关注性能点

简单来讲，其他角色关注的性能点都是测试人员需要关注的

# 软件性能术语

## 响应时间

所谓响应时间，是`对请求作出响应所需要的时间`

响应时间计算公式为

$$ RT = N1 + N2 + N3 + a1 + a3 + a2 + N4 $$

网络传输时间: N1 + N2 + N3 + N4
应用服务处理时间: a1 + a3 (服务器本身响应处理时间，可以在服务器本地测试出来, a1 是持久化前，a3 是持久化后)
数据持久化处理时间： a2

`N*` 在 http 服务时表示各个处理节点 `DNS Lookup`, `TCP Connection`, `TLS Handshake`, `Content Transfer`

- DNS Lookup 为DNS发现时间
- TCP connection 为TCP建立连接耗时
- TCP Handshake 为TCP建立握手耗时
- Content Transfer 为上下文传输时间

> 在基于类似 UDP 传输这种模型时，网络传输时间中，不建立连接，不保证成功，也就没有响应时间概念
> 更复杂的，基于 UDP 做成类似 TCP 的传输机制，需要在 UDP 的耗时上加入业务握手的耗时即可


## 并发用户数

- `系统用户数`: 系统额定的用户数量
- `同时在线用户数`: 在一定的时间范围内，最大的同时在线用户数量

```
同时在线用户数=每秒请求数RPS（吞吐量）+并发连接数+平均用户思考时间
```

- 平均并发用户数计算公式


$$ C = n * L / T $$

公式解析

```
C是平均的并发用户数
n是平均每天访问用户数（login session）
L是一天内用户从登录到退出的平均时间（login session的平均时间）
T是考察时间长度（一天内多长时间有用户使用系统）
```

- 并发用户数峰值计算公式

$$ maxC = C + 3 * \sqrt{c} $$

- `maxC` 是并发用户峰值
- `C` 平均并发用户数，该公式遵循泊松分布理论

## 吞吐量

指单位时间内系统处理用户的请求数

从`业务角度`看，吞吐量可以用：`请求数/秒`、`页面数/秒`、`人数/天或处理业务数/小时` 等单位来衡量
从`网络角度`看，吞吐量可以用：`字节/秒` 来衡量
`对于交互式应用`来说，吞吐量指标反映的是服务器承受的压力，他能够说明系统的负载能力

以不同方式表达的吞吐量可以说明不同层次的问题

> 例如，以字节数/秒方式可以表示数要受网络基础设施、服务器架构、应用服务器制约等方面的瓶颈
已请求数/秒的方式表示主要是受应用服务器和应用代码的制约体现出的瓶颈

当`没有遇到性能瓶颈的时候，吞吐量与虚拟用户数之间存在一定的联系`，吞吐量计算公式为

$$ F = VU * R / T $$

- F 为吞吐量
- VU 表示虚拟用户数
- R 表示每个虚拟用户发出的请求数
- T 表示测试性能所用的时间

## 性能计数器

是描述`服务器或操作系统性能的一些数据指标`
如使用 `内存数、进程时间`
在性能测试中发挥着“监控和分析”的作用，尤其是在分析统统可扩展性、进行新能瓶颈定位时有着非常关键的作用

## 思考时间

`Think Time 思考时间`，从业务角度来看，这个时间指用户进行操作时每个请求之间的时间间隔
而在做性能测试时，为了模拟这样的时间间隔，引入了思考时间这个概念，来更加真实的模拟用户的操作

吞吐量这个公式中 `F = VU * R / T`
说明 `吞吐量F`是 `VU数量`、`每个用户发出的请求数R`和`时间T`的函数
而其中的 `R` 又可以用 `时间T` 和 `用户思考时间TS`来计算

$$ R = T / TS $$

计算思考时间的一般步骤

A. 首先计算出系统的并发用户数

$$ C = n * L / T $$

那么吞吐量

$$ F = R×C $$

B. 统计出系统平均的吞吐量

$$ F=VU * R / T $$
$$ R×C = VU * R / T $$

C. 统计出平均每个用户发出的请求数量

$$ R = u * C * T / VU $$

D. 根据公式计算出思考时间

$$ TS = T / R $$

